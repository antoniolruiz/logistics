<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-1 sm:p-2">
        <div class="max-w-full mx-auto bg-white rounded-lg shadow-sm p-2 md:p-3">
            <header class="mb-8">
                <div class="flex items-center justify-between mb-6">
                    <img id="vectorLogo" src="https://cdn-eblmdf.nitrocdn.com/vVuBUVEtyJTDzFmiTWcmAlTgwfLlYdtZ/assets/images/optimized/rev-d91b495/www.withvector.com/wp-content/uploads/2024/09/vector-logo.png" alt="Vector Logo" style="height:38px; width:auto;" class="rounded-lg shadow-sm hover:scale-105 transition-transform duration-200 cursor-pointer" />
                    <button id="settingsBtn" class="p-2 rounded-full bg-orange-500 hover:bg-orange-600 text-white shadow-lg transition-all duration-200 hover:scale-105" title="Settings">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5a3.5 3.5 0 0 1-3.5 3.5m7.43-2.53c.04-.32.07-.64.07-.97c0-.33-.03-.66-.07-1l2.11-1.63c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.31-.61-.22l-2.49 1c-.52-.39-1.06-.73-1.69-.98l-.37-2.65A.506.506 0 0 0 14 2h-4c-.25 0-.46.18-.5.42l-.37 2.65c-.63.25-1.17.59-1.69.98l-2.49-1c-.22-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64L4.57 11c-.04.34-.07.67-.07 1c0 .33.03.65.07.97l-2.11 1.66c-.19.15-.25.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1.01c.52.4 1.06.74 1.69.99l.37 2.65c.04.24.25.42.5.42h4c.25 0 .46-.18.5-.42l.37-2.65c.63-.26 1.17-.59 1.69-.99l2.49 1.01c.22.08.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.66Z"/>
                        </svg>
                    </button>
                </div>
                <div class="text-center">
                    <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 font-google-sans">Document Intelligence</h1>
                    <p class="mt-2 text-gray-600">Select or upload a document, and our AI will extract key details into a structured format.</p>
                </div>
            </header>

            <div id="aiConfigSection" class="settings-panel rounded-xl p-6 mb-8 hidden">
                <div class="mb-6">
                    <h1 class="text-2xl font-bold text-gray-900 mb-2">Settings</h1>
                    <p class="text-gray-600">Manage your account settings and preferences.</p>
                </div>

                <!-- Settings Navigation Tabs -->
                <div class="border-b border-gray-200 mb-6">
                    <nav class="flex space-x-8" aria-label="Settings Tabs">
                        <button id="settingsTabGeneral" class="settings-tab active">General</button>
                        <button id="settingsTabAI" class="settings-tab">AI Configuration</button>
                        <button id="settingsTabAPI" class="settings-tab">API Configuration</button>
                        <button id="settingsTabConfidence" class="settings-tab">Confidence</button>
                    </nav>
                </div>

                <!-- General Settings Tab -->
                <div id="settingsContentGeneral" class="settings-content">
                    <div class="settings-section">
                        <h3>Application Preferences</h3>
                        <p>Configure general application behavior and preferences.</p>
                        
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="text-sm font-medium text-gray-700">Auto-save results</label>
                                    <p class="text-xs text-gray-500">Automatically save parsed results to local storage</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoSaveToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="text-sm font-medium text-gray-700">Show coordinate overlays</label>
                                    <p class="text-xs text-gray-500">Display red rectangles when hovering over extracted fields</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="coordinateOverlaysToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>Theme Preferences</h3>
                        <p>Customize the appearance of the application.</p>
                        
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="text-sm font-medium text-gray-700">Dark Mode</label>
                                    <p class="text-xs text-gray-500">Switch between light and dark themes</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="darkModeToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            

                        </div>
                    </div>
                </div>

                <!-- AI Configuration Settings Tab -->
                <div id="settingsContentAI" class="settings-content hidden">
                    <div class="settings-section">
                        <h3>AI Model Configuration</h3>
                        <p>Choose your preferred AI model and configure API access for document parsing.</p>
                        
                        <div class="space-y-4">
                            <div>
                                <label for="modelSelector" class="block text-sm font-medium text-gray-700 mb-2">Selected AI Model</label>
                                <select id="modelSelector" class="form-input w-full">
                                    <option value="gemini-1.5-pro-latest">Gemini 1.5 Pro</option>
                                    <option value="gemini-1.5-flash-latest">Gemini 1.5 Flash</option>
                                    <option value="gemini-2.5-pro" selected>Gemini 2.5 Pro (Recommended)</option>
                                    <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                                    <option value="gpt-4o">OpenAI GPT-4o</option>
                                    <option value="claude-4">Claude 4</option>
                                </select>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="text-sm font-medium text-gray-700">Use custom parsing prompt</label>
                                    <p class="text-xs text-gray-500">Customize the AI instructions for document parsing</p>
                                </div>
                                <button id="editBolPromptBtn" class="bg-blue-100 text-blue-700 px-3 py-1 rounded-lg hover:bg-blue-200 transition-colors text-sm font-medium">
                                    Edit Prompt
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="googleKeyContainer" class="settings-section">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <h3>Google AI API Key</h3>
                                <p class="text-xs text-gray-500 mt-1">Required for Gemini models</p>
                            </div>
                            <button id="howToBtn" class="bg-green-100 text-green-700 px-3 py-1 rounded-lg hover:bg-green-200 transition-colors text-sm font-medium">
                                Get Key
                            </button>
                        </div>
                        
                        <div class="mt-3">
                            <input type="password" id="googleApiKeyInput" placeholder="Enter your Google AI API Key" class="form-input w-full">
                        </div>
                    </div>

                    <div id="openaiKeyContainer" class="settings-section">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <h3>OpenAI API Key</h3>
                                <p class="text-xs text-gray-500 mt-1">Required for GPT and Claude models</p>
                            </div>
                            <button id="howToBtnOpenAI" class="bg-green-100 text-green-700 px-3 py-1 rounded-lg hover:bg-green-200 transition-colors text-sm font-medium">
                                Get Key
                            </button>
                        </div>
                        
                        <div class="mt-3">
                            <input type="password" id="openaiApiKeyInput" placeholder="Enter your OpenAI API Key" class="form-input w-full">
                        </div>
                    </div>
                </div>

                <!-- API Configuration Settings Tab -->
                <div id="settingsContentAPI" class="settings-content hidden">
                    <div class="settings-section">
                        <h3>Vector API Configuration</h3>
                        <p class="text-xs text-gray-500 mt-1">Configure Vector API for document retrieval</p>
                        
                        <div class="space-y-4 mt-4">
                            <div>
                                <label for="settingsVectorApiEndpoint" class="block text-sm font-medium text-gray-700 mb-2">API Endpoint</label>
                                <input type="text" id="settingsVectorApiEndpoint" value="https://api.withvector.com/1.0/entities/query?DEBUG=view--Documents" class="form-input w-full" placeholder="Enter Vector API endpoint">
                            </div>
                            <div>
                                <label for="settingsVectorBearerToken" class="block text-sm font-medium text-gray-700 mb-2">Bearer Token</label>
                                <input type="password" id="settingsVectorBearerToken" value="616763a6732f40eeaa0e042826d29824" class="form-input w-full" placeholder="Enter bearer token">
                            </div>
                            <div>
                                <label for="settingsVectorFacility" class="block text-sm font-medium text-gray-700 mb-2">Facility Name</label>
                                <input type="text" id="settingsVectorFacility" value="US Cold Lumberton" class="form-input w-full" placeholder="Enter facility name">
                                <p class="text-xs text-gray-500 mt-1">Filter documents by facility (core_documents_shipment.facility.displayName)</p>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="settingsVectorDateRange" class="block text-sm font-medium text-gray-700 mb-2">Date Range (days)</label>
                                    <input type="number" id="settingsVectorDateRange" value="30" min="1" max="365" class="form-input w-full" placeholder="Number of days">
                                    <p class="text-xs text-gray-500 mt-1">Documents from the past X days</p>
                                </div>
                                <div>
                                    <label for="settingsVectorResultSize" class="block text-sm font-medium text-gray-700 mb-2">Result Size</label>
                                    <input type="number" id="settingsVectorResultSize" value="100" min="1" max="1000" class="form-input w-full" placeholder="Maximum results">
                                    <p class="text-xs text-gray-500 mt-1">Maximum number of documents to load</p>
                                </div>
                            </div>
                            <div class="flex justify-end">
                                <button id="saveVectorApiSettings" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">
                                    Save Vector API Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Confidence Settings Tab -->
                <div id="settingsContentConfidence" class="settings-content hidden">
                    <div class="settings-section">
                        <h3>Confidence Level Settings</h3>
                        <p>Adjust confidence thresholds to control how extracted data accuracy is displayed.</p>
                        
                        <!-- High Confidence Setting -->
                        <div class="confidence-range-container">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-3">
                                    <div class="confidence-color bg-green-500"></div>
                                    <div>
                                        <label for="highConfidenceSlider" class="text-sm font-medium text-gray-700">High Confidence</label>
                                        <p class="text-xs text-gray-500">Fields with excellent extraction accuracy</p>
                                    </div>
                                </div>
                                <div class="range-value-display" id="highValueDisplay">95%</div>
                            </div>
                            <div class="mt-3">
                                <input type="range" id="highConfidenceSlider" min="85" max="100" value="95" class="range-slider">
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>85%</span>
                                    <span>Perfect (100%)</span>
                                </div>
                            </div>
                        </div>

                        <!-- Medium Confidence Setting -->
                        <div class="confidence-range-container">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-3">
                                    <div class="confidence-color bg-orange-500"></div>
                                    <div>
                                        <label for="mediumConfidenceSlider" class="text-sm font-medium text-gray-700">Medium Confidence</label>
                                        <p class="text-xs text-gray-500">Fields with good extraction accuracy</p>
                                    </div>
                                </div>
                                <div class="range-value-display" id="mediumValueDisplay">80%</div>
                            </div>
                            <div class="mt-3">
                                <input type="range" id="mediumConfidenceSlider" min="60" max="94" value="80" class="range-slider">
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>60%</span>
                                    <span>94%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Low Confidence Info -->
                        <div class="confidence-range-container">
                            <div class="flex items-center gap-3">
                                <div class="confidence-color bg-red-500"></div>
                                <div class="flex-1">
                                    <label class="text-sm font-medium text-gray-700">Low Confidence</label>
                                    <p class="text-xs text-gray-500">Fields below medium threshold - requires manual review</p>
                                </div>
                                <div class="confidence-badge bg-red-500">
                                    <span id="lowRangeDisplay">&lt; 80%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Live Preview -->
                        <div class="mt-6">
                            <h4 class="text-sm font-medium text-gray-700 mb-3">Preview</h4>
                            <div class="confidence-preview">
                                <div class="preview-item">
                                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                    <span>High: <span id="previewHigh">95%+</span></span>
                                </div>
                                <div class="preview-item">
                                    <div class="w-3 h-3 bg-orange-500 rounded-full"></div>
                                    <span>Medium: <span id="previewMedium">80%-94%</span></span>
                                </div>
                                <div class="preview-item">
                                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                    <span>Low: <span id="previewLow">&lt;80%</span></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 pt-4 border-t border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <label class="text-sm font-medium text-gray-700">Show confidence indicators</label>
                                    <p class="text-xs text-gray-500">Display colored dots next to extracted fields</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="showConfidenceIndicators" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mt-6 flex justify-between items-center">
                            <button id="resetConfidenceDefaults" class="text-sm text-gray-600 hover:text-gray-800 transition-colors">
                                Reset to Defaults
                            </button>
                            <button id="saveConfidenceSettings" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                Save Changes
                            </button>
                        </div>
                    </div>
                </div>


            </div>

            <div id="bolContent">
                <!-- Document Upload Method Selector -->
                <div class="mb-6">
                    <label class="block text-lg font-medium text-gray-700 font-google-sans mb-4">Select Document Source</label>
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button id="uploadMethodVector" class="upload-method-btn active px-4 py-2 rounded-lg border-2 border-blue-500 bg-blue-50 text-blue-700 font-medium transition-all duration-200 hover:bg-blue-100">
                            <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" clip-rule="evenodd"/></svg>
                            Vector API
                        </button>
                        <button id="uploadMethodPdf" class="upload-method-btn px-4 py-2 rounded-lg border-2 border-gray-300 bg-white text-gray-700 font-medium transition-all duration-200 hover:bg-gray-50">
                            <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20"><path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"/></svg>
                            Upload PDF
                        </button>
                        <button id="uploadMethodCamera" class="upload-method-btn px-4 py-2 rounded-lg border-2 border-gray-300 bg-white text-gray-700 font-medium transition-all duration-200 hover:bg-gray-50">
                            <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/></svg>
                            Take Photo
                        </button>
                    </div>
                </div>

                <!-- PDF Upload Section -->
                <div id="pdfUploadSection" class="upload-section">
                    <label for="bolUpload" class="flex flex-col items-center justify-center w-full min-h-[16rem] border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition p-4">
                        <div id="bol-prompt-text" class="flex flex-col items-center justify-center text-center">
                            <svg class="w-10 h-10 mb-4 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/></svg>
                            <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Click to upload a PDF</span></p>
                            <p id="pdfFileName" class="text-sm text-green-600 font-semibold mt-2"></p>
                        </div>
                        <div id="bol-preview-container" class="mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
                        <input id="bolUpload" type="file" class="hidden" accept="application/pdf" />
                    </label>
                </div>

                <!-- Camera Capture Section -->
                <div id="cameraSection" class="upload-section hidden">
                    <div class="border-2 border-gray-300 border-dashed rounded-lg p-6 bg-gray-50">
                        <div id="cameraControls" class="text-center">
                            <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                            </svg>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">Document Camera</h3>
                            <p class="text-sm text-gray-600 mb-4">Take a photo of your document for analysis</p>
                            <button id="startCamera" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                                <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                                </svg>
                                Start Camera
                            </button>
                        </div>
                        <div id="cameraPreview" class="hidden">
                            <video id="cameraVideo" class="w-full max-w-md mx-auto rounded-lg mb-4" autoplay playsinline></video>
                            <div class="text-center space-x-4">
                                <button id="capturePhoto" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">
                                    <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                                    </svg>
                                    Capture
                                </button>
                                <button id="stopCamera" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition">
                                    <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"/>
                                    </svg>
                                    Stop
                                </button>
                            </div>
                        </div>
                        <canvas id="captureCanvas" class="hidden"></canvas>
                        <div id="capturedImage" class="hidden mt-4">
                            <img id="capturedImagePreview" class="w-full max-w-md mx-auto rounded-lg border" />
                            <div class="text-center mt-4 space-x-4">
                                <button id="retakePhoto" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition">
                                    <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                                    </svg>
                                    Retake
                                </button>
                                <button id="usePhoto" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                                    <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                    </svg>
                                    Use Photo
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vector API Section -->
                <div id="vectorApiSection" class="upload-section hidden">
                    <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                        <div class="mb-4">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900">Vector API Documents</h3>
                                    <p class="text-sm text-gray-600">Auto-refreshing every minute. Configure API settings in the Settings panel.</p>
                                </div>
                                <button id="refreshVectorDocuments" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm">
                                    <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                                    </svg>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        <div id="vectorApiStatus" class="hidden mb-4 p-3 rounded-lg"></div>
                        <div id="vectorDocumentsList">
                            <div class="flex justify-between items-center mb-3">
                                <div>
                                    <h4 class="text-lg font-semibold text-gray-900">Available Documents</h4>
                                    <p id="documentsCount" class="text-sm text-gray-600"></p>
                                </div>
                                <div class="relative">
                                    <input type="text" id="documentSearchInput" placeholder="Search documents..." class="pl-8 pr-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 w-64">
                                    <svg class="absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg overflow-hidden">
                                <div class="overflow-x-auto">
                                    <table id="documentsTable" class="w-full min-w-[1200px]">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-52">Document</th>
                                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32">Received Date</th>
                                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32">Signed Date</th>
                                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24">Trailer #</th>
                                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24">Seal #</th>
                                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24">Set Temp</th>
                                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32">Driver</th>
                                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32">Firm</th>
                                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32">Receiver (Signer)</th>
                                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32">Check In Time</th>
                                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="documentsTableBody" class="bg-white">
                                            <!-- Documents will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                                <div id="noDocumentsMessage" class="hidden text-center py-8 text-gray-500">
                                    <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    <p>No documents found</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col items-center mt-8 mb-8">
                    <div class="flex flex-col sm:flex-row items-center gap-4 mb-4">
                        <button id="parseBolBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition duration-300 ease-in-out shadow-md disabled:bg-gray-400 disabled:cursor-not-allowed">Analyze Document</button>
                        <div id="analyzeStatusMessage" class="hidden">
                            <div class="flex items-center gap-2 px-4 py-2 rounded-lg">
                                <div id="statusIcon" class="flex-shrink-0"></div>
                                <span id="statusText" class="text-sm font-medium whitespace-nowrap"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    
    <div id="loading" class="text-center my-4 hidden px-4 sm:px-6 lg:px-8">
        <div class="w-full max-w-2xl mx-auto">
            <div class="flex items-center justify-center mb-2">
                <span id="progressLabel" class="text-xl font-semibold text-blue-600">Loading...</span>
            </div>
            <div class="w-full bg-blue-100 rounded-full h-6 relative overflow-hidden">
                <div id="progressBar" class="h-6 bg-blue-500 rounded-full transition-all duration-500 ease-in-out" style="width: 0%"></div>
            </div>
        </div>
    </div>
    <div id="messageContainer" class="hidden px-4 sm:px-6 lg:px-8">
         <div id="message" class="text-red-600 font-medium"></div>
    </div>
    
    <div id="resultsWrapper" class="hidden">
         <div id="bolResultContainer" class="hidden mt-6 px-4 sm:px-6 lg:px-8">
             <div class="flex justify-between items-center mb-6 py-4 border-b border-gray-200">
                 <h2 class="text-xl font-semibold text-gray-800">Extracted Details</h2>
                 <div class="flex items-center gap-3">
                     <button id="rawResultsBtn" class="text-gray-700 font-medium py-2 px-4 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors bg-white">
                        Raw Results
                     </button>
                     <button id="printBolBtn" class="text-gray-700 font-medium py-2 px-4 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors bg-white">
                         Print Results
                     </button>
                     <button id="exportBolBtn" class="bg-blue-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                         Download CSV
                     </button>
                 </div>
             </div>
            <div id="bolResultCard" class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                </div>
        </div>
    </div>

    <div id="sidePanelOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
    <div id="sidePanel" class="fixed top-0 right-0 h-full w-full max-w-md bg-white shadow-xl z-50 transform translate-x-full transition-transform duration-300 ease-in-out">
        <div class="flex flex-col h-full">
            <div class="flex justify-between items-center p-4 border-b">
                <h2 class="text-xl font-google-sans font-bold">API Key Help</h2>
                <button id="closePanelBtn" class="p-2 rounded-full hover:bg-gray-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/></svg>
                </button>
            </div>
             <div class="border-b border-gray-200">
                <nav class="flex" aria-label="Side Panel Tabs">
                    <button id="panelTabKey" class="side-panel-tab active flex-1 border-b-2 py-3 px-1 text-center text-sm font-medium text-gray-500 hover:text-gray-700">Get API Key</button>
                    <button id="panelTabBilling" class="side-panel-tab flex-1 border-b-2 border-transparent py-3 px-1 text-center text-sm font-medium text-gray-500 hover:text-gray-700">Enable Billing</button>
                </nav>
            </div>
            <div id="panelContentKey" class="p-6 overflow-y-auto flex-grow">
                <div class="space-y-6">
                    <div>
                        <h3 class="font-bold font-google-sans text-lg mb-2">Step 1: Go to Google AI Studio</h3>
                        <p class="mb-3 text-sm">Navigate to <a href="https://aistudio.google.com/" target="_blank" class="text-blue-600 hover:underline">aistudio.google.com</a> and sign in with your Google account.</p>
                        <img src="https://storage.googleapis.com/gemini-codelab-images/tutorial-api-key-1.png" alt="Google AI Studio Homepage" class="rounded-lg border shadow-sm" onerror="this.onerror=null;this.src='https://placehold.co/600x300/e2e8f0/334155?text=Image+Not+Found';">
                    </div>
                    <div>
                        <h3 class="font-bold font-google-sans text-lg mb-2">Step 2: Get API Key</h3>
                        <p class="mb-3 text-sm">Once in AI Studio, click <b>"Get API key"</b> from the left-hand menu.</p>
                        <img src="https://storage.googleapis.com/gemini-codelab-images/tutorial-api-key-2.png" alt="Get API Key button" class="rounded-lg border shadow-sm" onerror="this.onerror=null;this.src='https://placehold.co/600x300/e2e8f0/334155?text=Image+Not+Found';">
                    </div>
                    <div>
                        <h3 class="font-bold font-google-sans text-lg mb-2">Step 3: Create API key in a new project</h3>
                        <p class="mb-3 text-sm">A dialog will appear. Click on <b>"Create API key in new project"</b>.</p>
                        <img src="https://storage.googleapis.com/gemini-codelab-images/tutorial-api-key-3.png" alt="Create API Key in new project" class="rounded-lg border shadow-sm" onerror="this.onerror=null;this.src='https://placehold.co/600x300/e2e8f0/334155?text=Image+Not+Found';">
                    </div>
                    <div>
                        <h3 class="font-bold font-google-sans text-lg mb-2">Step 4: Copy Your Key</h3>
                        <p class="mb-3 text-sm">Your new API key will be displayed. Click the copy icon to copy the key.</p>
                        <img src="https://storage.googleapis.com/gemini-codelab-images/tutorial-api-key-4.png" alt="Copy new API key" class="rounded-lg border shadow-sm" onerror="this.onerror=null;this.src='https://placehold.co/600x300/e2e8f0/334155?text=Image+Not+Found';">
                    </div>
                    <div>
                        <h3 class="font-bold font-google-sans text-lg mb-2">Step 5: Paste it Here</h3>
                        <p class="mb-3 text-sm">Return to this page and paste the key into the "Google AI API Key" input field.</p>
                        <img src="https://storage.googleapis.com/gemini-codelab-images/tutorial-api-key-5.png" alt="Paste key into the application" class="rounded-lg border shadow-sm" onerror="this.onerror=null;this.src='https://placehold.co/600x300/e2e8f0/334155?text=Image+Not+Found';">
                    </div>
                </div>
            </div>
            <div id="panelContentBilling" class="p-6 overflow-y-auto flex-grow hidden">
                 <div class="space-y-6">
                    <div>
                        <h3 class="font-bold font-google-sans text-lg mb-2">Step 1: Go to Google Cloud Console</h3>
                        <p class="mb-3 text-sm">Navigate to the <a href="https://console.cloud.google.com/" target="_blank" class="text-blue-600 hover:underline">Google Cloud Console</a> and select the project associated with your API key.</p>
                        <img src="https://storage.googleapis.com/gemini-codelab-images/billing-1.png" alt="Google Cloud Console" class="rounded-lg border shadow-sm" onerror="this.onerror=null;this.src='https://placehold.co/600x300/e2e8f0/334155?text=Image+Not+Found';">
                    </div>
                    <div>
                        <h3 class="font-bold font-google-sans text-lg mb-2">Step 2: Open Billing Menu</h3>
                        <p class="mb-3 text-sm">Click the main navigation menu (hamburger icon) and select <b>"Billing"</b>.</p>
                        <img src="https://storage.googleapis.com/gemini-codelab-images/billing-2.png" alt="Billing Menu" class="rounded-lg border shadow-sm" onerror="this.onerror=null;this.src='https://placehold.co/600x300/e2e8f0/334155?text=Image+Not+Found';">
                    </div>
                    <div>
                        <h3 class="font-bold font-google-sans text-lg mb-2">Step 3: Link a Billing Account</h3>
                        <p class="mb-3 text-sm">If your project doesn't have a billing account, you'll see a prompt to <b>"Link a billing account"</b>. Click it. If you need to create one, select <b>"Manage billing accounts"</b> and then <b>"Create account"</b>.</p>
                        <img src="https://storage.googleapis.com/gemini-codelab-images/billing-3.png" alt="Link billing account" class="rounded-lg border shadow-sm" onerror="this.onerror=null;this.src='https://placehold.co/600x300/e2e8f0/334155?text=Image+Not+Found';">
                    </div>
                    <div>
                        <h3 class="font-bold font-google-sans text-lg mb-2">Step 4: Set Up Payment</h3>
                        <p class="mb-3 text-sm">Follow the on-screen instructions to provide your payment information and complete the setup.</p>
                        <img src="https://storage.googleapis.com/gemini-codelab-images/billing-4.png" alt="Payment information" class="rounded-lg border shadow-sm" onerror="this.onerror=null;this.src='https://placehold.co/600x300/e2e8f0/334155?text=Image+Not+Found';">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="promptSidePanelOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
    <div id="promptSidePanel" class="fixed top-0 right-0 h-full w-full max-w-lg bg-white shadow-xl z-50 transform translate-x-full transition-transform duration-300 ease-in-out">
        <div class="flex flex-col h-full">
            <div class="flex justify-between items-center p-4 border-b">
                <h2 class="text-xl font-google-sans font-bold">Edit Prompt</h2>
                <button id="closePromptPanelBtn" class="p-2 rounded-full hover:bg-gray-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/></svg>
                </button>
            </div>
            <div id="promptPanelContentBol" class="p-6 overflow-y-auto flex-grow flex flex-col">
                <label for="bolPromptTextarea" class="font-semibold mb-2">Document Prompt</label>
                <textarea id="bolPromptTextarea" class="w-full flex-grow p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500"></textarea>
                 <div class="mt-4 flex gap-4">
                     <button id="saveBolPromptBtn" class="flex-1 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700">Save</button>
                     <button id="resetBolPromptBtn" class="flex-1 bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300">Reset to Default</button>
                 </div>
            </div>
        </div>
    </div>
    
    <div id="imageZoomModal" class="hidden fixed inset-0 bg-black bg-opacity-75 items-center justify-center z-[100] p-4">
        <button id="closeZoomModal" class="absolute top-4 right-4 text-white text-4xl font-bold">&times;</button>
        <button id="zoomPrevBtn" class="absolute left-4 top-1/2 -translate-y-1/2 bg-black bg-opacity-50 text-white rounded-full p-2 hover:bg-opacity-75"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button>
        <img id="zoomedImage" src="" class="max-w-full max-h-full">
         <button id="zoomNextBtn" class="absolute right-4 top-1/2 -translate-y-1/2 bg-black bg-opacity-50 text-white rounded-full p-2 hover:bg-opacity-75"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg></button>
    </div>

    <div id="fieldEditModal" class="hidden fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-[100]">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
            <h3 id="editModalTitle" class="text-lg font-bold mb-4">Edit Field</h3>
            <div id="editModalContent">
                </div>
            <div class="mt-6 flex justify-end gap-4">
                <button id="cancelEditBtn" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300">Cancel</button>
                <button id="saveEditBtn" class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700">Save</button>
            </div>
        </div>
    </div>

    <div id="rawJsonModal" class="hidden fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-[100]">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl">
            <h3 class="text-lg font-bold mb-4">Raw JSON Output</h3>
            <pre id="rawJsonContent" class="bg-gray-100 p-4 rounded-md overflow-x-auto text-sm" style="max-height: 60vh;"></pre>
            <div class="mt-6 flex justify-end gap-4">
                <button id="closeRawJsonBtn" class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700">Close</button>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>
